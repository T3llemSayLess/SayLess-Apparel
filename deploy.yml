      log "ssh-copy-id failed (host unreachable or credentials missing). You may need to copy $(pwd)/$DEPLOY_KEY_PUBLIC into the remote server's ~/.ssh/authorized_keys manually."
      log "Public key path: $(pwd)/$DEPLOY_KEY_PUBLIC"
    fi
  else
    log "ssh-copy-id not installed. Please add the public key to remote authorized_keys manually:"
    log "Public key path: $(pwd)/$DEPLOY_KEY_PUBLIC"
  fi
else
  log "No DEPLOY_HOST/DEPLOY_USER set â€” skipping automatic authorized_keys step."
fi

# -------------------------
# Finalize: push any remaining changes
# -------------------------
git add -A
git commit -m "chore: finalize GitHub CI/CD integration" || true
if [ -n "${GITHUB_USER:-}" ] && gh api user >/dev/null 2>&1; then
  git push origin "$MAIN_BRANCH" || true
fi

log "GitHub integration complete. Repo: ${GITHUB_USER:-<not-set>}/${REPO_NAME}"
if [ -f "$DEPLOY_KEY_PUBLIC" ]; then
  log "Generated deploy public key: $(pwd)/$DEPLOY_KEY_PUBLIC"
fi
log "If you want Actions to automatically SSH into a remote server, make sure the public key above is in that remote server's ~/.ssh/authorized_keys or let ssh-copy-id succeed earlier."
log "Done." 
